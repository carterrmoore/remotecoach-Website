(window["wpJsonpExtractCss"]=window["wpJsonpExtractCss"]||[]).push([[0],{"./src/main/webapp/frontend/packages/enums/BillingError.js":function(e,r){var t={CARD_DECLINED:1,FULFILLMENT_FAILED:2,CHARGE_FAILED:3,STRONG_AUTHENTICATION_FAILED:4};e.exports=t},"./src/main/webapp/frontend/packages/enums/BillingTaxType.js":function(e,r){var t={AUSTRALIAN_GST:"australian-gst",NZ_GST:"nz-gst",US_SALES:"us-sales",VAT:"vat",VAT_PROVINCE:"vat_province",NONE:"none"};e.exports=t},"./src/main/webapp/universal/src/shared/actions/billing/CustomerActions.js":function(e,r,t){"use strict";var a=t("./common/temp/node_modules/@babel/runtime/helpers/interopRequireDefault.js");var s=a(t("./common/temp/node_modules/@babel/runtime/helpers/classCallCheck.js"));var n=a(t("./common/temp/node_modules/@babel/runtime/helpers/createClass.js"));var i=t("./src/main/webapp/universal/src/shared/dispatchers/alt/index.ts");var o=t("./src/main/webapp/universal/src/shared/utils/CustomerAPI.js");var u=t("./src/main/webapp/universal/src/shared/utils/billing/TaxPreviewApi.js");var d=t("./src/main/webapp/universal/src/shared/components/forms/PaymentFormUtils.js");var l=t("./src/main/webapp/universal/src/shared/components/forms/StripeUtils.js");var c=t("./common/temp/node_modules/lodash/debounce.js");var m=t("./src/main/webapp/universal/src/shared/actions/billing/StripeElementsActions.js");var p=c(function(e,r){this.fetchTaxStatusPreview(Object.assign({},r,e))},1e3);var v=function(){function e(){(0,s.default)(this,e);this.generateActions("discardChanges","loadFailure","loadSuccess","fetchTaxStatusPreviewSuccess","fetchTaxStatusPreviewFailure","saveSuccess","beforeSave")}(0,n.default)(e,[{key:"change",value:function e(r,t){var a=this;return function(e){e(r);r.country||"customerCertified"in r?a.fetchTaxStatusPreview(Object.assign({},t,r)):(r.vatNumber||r.businessName||r.canadianGstNumber||r.canadianPstNumber||r.australianBusinessNumber||r.postalCode||r.zip)&&p.call(a,r,t)}}},{key:"fetchCreditCardCountryOfOriginIfPossible",value:function e(r){return l.getCreditCardPropertyFromStripe("country").then(function(e){if(e)return Promise.resolve(e);return Promise.resolve(null)})}},{key:"fetchTaxStatusPreview",value:function e(t){var r=arguments,a=this;return function(e){e();var r=t.country;a.fetchCreditCardCountryOfOriginIfPossible(t).then(function(e){return u.getTaxLiability({australianBusinessNumber:t.australianBusinessNumber||null,canadianGstNumber:t.canadianGstNumber||null,canadianPstNumber:t.canadianPstNumber||null,customerCertified:t.customerCertified||null,businessName:t.businessName||"",creditCardCountryCode:e,vatNumber:t.vatNumber||null,userProvidedCountryCode:r,postalCode:t.zip||t.postalCode||null})}).then(function(e){a.fetchTaxStatusPreviewSuccess(e.data)}).catch(function(){false})}}},{key:"save",value:function e(a){var s=this;var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var i=arguments.length>2?arguments[2]:void 0;return function(e){s.beforeSave();var r=d.normalizeFormDataForAPI(a,i);var t=n?o.create(r):o.save(r);t.then(function(e){var r=d.normalizeAPIDataForForm(e.data);s.saveSuccess(r)},function(e){s.saveFailure(e.data)}).catch(function(e){false});return t}}},{key:"getTokenAndSave",value:function e(r){var n=this;var i=r.customer,t=r.isNew,o=void 0!==t&&t,u=r.stripeElements,l=r.taxType,a=r.createSetupIntent,c=void 0!==a&&a;return function(e){e();var r=d.getErrorsOnSave(i,l);var t=i.country,a=i.name,s=i.postalCode;return m.getToken(u.cardNumber,{postalCode:s,country:t,name:a}).then(function(e){if(!e.id||r){n.saveFailure(r);return Promise.reject({data:r})}return n.save(Object.assign({},i,{cardToken:e.id,createSetupIntent:c}),o,l)})}}},{key:"saveFailure",value:function e(t){return function(e){var r=d.normalizeAPIErrorsForForm(t);e(r)}}},{key:"load",value:function e(){var t=this;return function(e){e();var r=o.loadCustomer().then(function(e){return d.normalizeAPIDataForForm(e.data)},function(e){var r=e.response;if(404===r.status)return null;throw r});r.then(function(e){t.loadSuccess(e)},function(e){t.loadFailure();console.error(e)});return r}}}]);return e}();e.exports=i.createActions(v)},"./src/main/webapp/universal/src/shared/actions/billing/StripeElementsActions.js":function(e,r,t){"use strict";var a=t("./common/temp/node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(r,"__esModule",{value:true});r.default=void 0;var n=a(t("./common/temp/node_modules/@babel/runtime/helpers/defineProperty.js"));var s=a(t("./common/temp/node_modules/@babel/runtime/helpers/classCallCheck.js"));var i=a(t("./common/temp/node_modules/@babel/runtime/helpers/createClass.js"));var o=a(t("./src/main/webapp/universal/src/shared/dispatchers/alt/index.ts"));var u=a(t("./src/main/webapp/universal/src/shared/utils/billing/Stripe.js"));var l=a(t("./common/temp/node_modules/platform/platform.js"));var c=a(t("./src/main/webapp/universal/src/shared/utils/analytics/trackInternal.ts"));var d=t("./src/main/webapp/universal/src/shared/utils/analytics/eventNames.js");function m(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}));t.push.apply(t,a)}return t}function p(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?m(Object(t),true).forEach(function(e){(0,n.default)(r,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):m(Object(t)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))})}return r}var v=[{cssSrc:"https://assets.squarespace.com/universal/fonts/squarespace-clarkson-v2.css"}];var f=function(){function e(){(0,s.default)(this,e);this.generateActions("clearElements","clearErrorFor","dismissLoadError","getStripeElementsSuccess","getStripeElementsFailure","getTokenSuccess","reset","setCardBrand","setComplete","setEmpty","setIncomplete","setNotEmpty")}(0,i.default)(e,[{key:"getToken",value:function e(r,t){var a=this;var s=t.postalCode,n=t.country,i=t.name;return function(e){e();return u.default.get().then(function(e){return e.createToken(r,{address_zip:s,address_country:n||void 0,name:i}).then(function(e){var r=e.token,t=e.error;if(t){console.warn(t);return t}a.getTokenSuccess(r);return r},function(e){console.warn(e)})})}}},{key:"confirmCardSetup",value:function e(r){return function(e){e();return u.default.get().then(function(e){return e.confirmCardSetup(r)})}}},{key:"getStripeElements",value:function e(){var r=this;var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"damask";var a=arguments.length>1?arguments[1]:void 0;var s="Microsoft Edge"===l.default.name||"IE"===l.default.name;var n=p({locale:a},s?{}:{fonts:v});return function(e){e();return u.default.get().then(function(e){r.getStripeElementsSuccess({elements:e.elements(n),theme:t})},function(e){r.getStripeElementsFailure(e)})}}},{key:"setError",value:function e(r){var t=r.errorCode,a=r.errorMessage,s=r.field;(0,c.default)(d.CHECKOUT_ENGAGEMENT_EVENT_NAME,{field:s,reason:t});return(0,n.default)({},s,a)}}]);return e}();var b=o.default.createActions(f);r.default=b;e.exports=r.default},"./src/main/webapp/universal/src/shared/components/forms/PaymentFormUtils.js":function(e,r,t){"use strict";var a=t("./src/main/webapp/frontend/packages/enums/BillingError.js");var o=t("./common/temp/node_modules/lodash/isEmpty.js");var u=t("./src/main/webapp/frontend/packages/enums/BillingTaxType.js");var s=t("./src/main/webapp/universal/src/shared/i18n/index.ts"),n=s.t;var l=["name","country"];var c=n("Required field");var i=n("Invalid postal code");var d=/(^\d{5}$)|(^\d{5}-\d{4}$)/;var m={getErrorsOnSave:function e(r,t){var a={};l.forEach(function(e){r[e]||(a[e]=c)});var s=t===u.VAT&&!!r.vatNumber&&!r.businessName;s&&(a.businessName=c);var n=t===u.AUSTRALIAN_GST&&!!r.australianBusinessNumber&&!r.registered;n&&(a.registered=c);var i=r.country;"US"===i&&Object.assign(a,this.getUSZIPValidationErrors(r.postalCode));return o(a)?null:a},isValidUSZIPCode:function e(r){return d.test(r)},getUSZIPValidationErrors:function e(r){var t={};r?this.isValidUSZIPCode(r)||(t.postalCode=i):t.postalCode=c;return t},normalizeFormDataForAPI:function e(r,t){var a=Object.assign({},r);if(a.postalCode&&!a.zip){a.zip=a.postalCode;delete a.postalCode}t===u.VAT&&(a.taxStatus={businessName:a.businessName,vatNumber:a.vatNumber});t===u.AUSTRALIAN_GST&&(a.taxStatus={businessName:a.businessName,australianBusinessNumber:a.australianBusinessNumber,customerCertified:a.customerCertified});t===u.NZ_GST&&(a.taxStatus={customerCertified:a.customerCertified});t===u.VAT_PROVINCE&&(a.taxStatus={businessName:a.businessName,canadianGstNumber:a.canadianGstNumber,canadianPstNumber:a.canadianPstNumber});return a},normalizeAPIDataForForm:function e(r){var t=Object.assign({},r);if(t){t.postalCode=t.zip;delete t.zip;Object.assign(t,t.taxStatus);delete t.taxStatus}return t},normalizeAPIErrorsForForm:function e(r){var t=Object.assign({},r);if(t.billingErrorCode===a.CARD_DECLINED){t.cardNumber=n("Your card has been declined. Please try again with another card.");delete t.billingErrorCode}if(t.zip){t.postalCode=t.zip;delete t.zip}return t},normalizeFormDataForStripe:function e(r){var t=Object.assign({},r);var a={cardNumber:"number",expirationMonth:"exp_month",expirationYear:"exp_year",postalCode:"address_zip"};Object.keys(t).forEach(function(e){var r=a[e];if(void 0!==t[e]&&void 0===t[r]){t[r]=t[e];delete t[e]}});t.currency&&(t.currency=t.currency.toLowerCase());return t}};e.exports=m},"./src/main/webapp/universal/src/shared/components/forms/StripeUtils.js":function(e,r,t){"use strict";var o=t("./src/main/webapp/universal/src/shared/utils/billing/Stripe.js");var s=t("./src/main/webapp/universal/src/shared/stores/billing/StripeElementsStore.js");var a={getCreditCardPropertyFromStripe:function e(n){var r=s.getState(),t=r.completedFields,i=r.elements;var a=t.cardNumber&&t.cvv&&t.expiry;if(!a)return Promise.resolve(null);return new Promise(function(a,s){o.get().then(function(e){e.createToken(i.cardNumber).then(function(e){var r=e.token,t=e.error;if(t){s(t);return}r&&n in r.card?a(r.card[n]):s("Property: ".concat(n," does not exist on stripe card."))})},s)})}};e.exports=a},"./src/main/webapp/universal/src/shared/stores/billing/StripeAPIKeyStore.js":function(e,r,t){"use strict";var a=t("./common/temp/node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(r,"__esModule",{value:true});r.default=void 0;var s=a(t("./common/temp/node_modules/@babel/runtime/helpers/classCallCheck.js"));var n=a(t("./common/temp/node_modules/@babel/runtime/helpers/createClass.js"));var i=a(t("./src/main/webapp/universal/src/shared/actions/BootstrapHelper.js"));var o=function(){function e(){(0,s.default)(this,e);this.key=null}(0,n.default)(e,[{key:"getStateFromContext",value:function e(r){this.key=r.stripePublishableKey}}]);return e}();var u=(0,i.default)(o,"StripeAPIKeyStore");r.default=u;e.exports=r.default},"./src/main/webapp/universal/src/shared/stores/billing/StripeElementsStore.js":function(e,r,t){"use strict";var a=t("./common/temp/node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(r,"__esModule",{value:true});r.default=void 0;var s=a(t("./common/temp/node_modules/@babel/runtime/helpers/defineProperty.js"));var n=a(t("./common/temp/node_modules/@babel/runtime/helpers/classCallCheck.js"));var i=a(t("./common/temp/node_modules/@babel/runtime/helpers/createClass.js"));var o=a(t("./common/temp/node_modules/lodash/cloneDeep.js"));var u=a(t("./src/main/webapp/universal/src/shared/dispatchers/alt/index.ts"));var l=t("./src/main/webapp/universal/src/shared/i18n/index.ts");var c=a(t("./src/main/webapp/universal/src/shared/actions/billing/StripeElementsActions.js"));var d='"Clarkson", "Proxima Nova", "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif';var m={damask:{base:{fontFamily:d,fontSize:"12px",lineHeight:"22px","::placeholder":{color:"#D0D0D0",fontFamily:d,fontSize:"12px"}},invalid:{color:"#3E3E3E"}},midnight:{base:{fontFamily:d,color:"#313131",fontSize:"13px",fontWeight:"300","::placeholder":{color:"#A1A1A1",fontFamily:d,fontSize:"13px"}},invalid:{color:"#313131"}}};var p={cardNumber:(0,l.t)("Card Number"),cardExpiry:(0,l.t)("MM / YY"),cardCvc:(0,l.t)("CVC")};var v={brand:null,completedFields:{},elements:{cardNumber:null,cardExpiry:null,cardCvc:null},elementsLoaded:false,emptyFields:{cardNumber:true,expiry:true,cvv:true},errors:{},loadError:false,token:null};var f=function(){function e(){(0,n.default)(this,e);this.bindActions(c.default);this.state=(0,o.default)(v)}(0,i.default)(e,[{key:"onClearElements",value:function e(){var r=this.state.elements;var t=r.cardNumber,a=r.cardExpiry,s=r.cardCvc;t.clear();a.clear();s.clear();this.setState({completedFields:{},emptyFields:{cardNumber:true,expiry:true,cvv:true},errors:{}})}},{key:"onClearErrorFor",value:function e(r){var t=this.state.errors;delete t[r];this.setState({errors:t})}},{key:"onDismissLoadError",value:function e(){this.setState({loadError:false})}},{key:"onGetTokenSuccess",value:function e(r){this.setState({token:r})}},{key:"onGetStripeElementsSuccess",value:function e(r){var t=r.elements,a=r.theme;var s=t.create("cardNumber",{placeholder:p.cardNumber,style:m[a]});var n=t.create("cardExpiry",{placeholder:p.cardExpiry,style:m[a]});var i=t.create("cardCvc",{placeholder:p.cardCvc,style:m[a]});this.setState({elements:{cardNumber:s,cardExpiry:n,cardCvc:i},elementsLoaded:true})}},{key:"onGetStripeElementsFailure",value:function e(r){this.setState({loadError:true})}},{key:"onSetCardBrand",value:function e(r){this.setState({brand:r})}},{key:"onSetComplete",value:function e(r){var t=this.state.completedFields;this.setState({completedFields:Object.assign({},t,(0,s.default)({},r,true))})}},{key:"onSetEmpty",value:function e(r){var t=this.state.emptyFields;this.setState({emptyFields:Object.assign({},t,(0,s.default)({},r,true))})}},{key:"onSetIncomplete",value:function e(r){var t=this.state.completedFields;this.setState({completedFields:Object.assign({},t,(0,s.default)({},r,false))})}},{key:"onSetNotEmpty",value:function e(r){var t=this.state.emptyFields;this.setState({emptyFields:Object.assign({},t,(0,s.default)({},r,false))})}},{key:"onSetError",value:function e(r){var t=this.state.errors;this.setState({errors:Object.assign({},t,r)})}},{key:"onReset",value:function e(){this.setState((0,o.default)(v))}}]);return e}();var b=u.default.createStore(f,"StripeElementsStore");r.default=b;e.exports=r.default},"./src/main/webapp/universal/src/shared/utils/CustomerAPI.js":function(e,r,t){"use strict";var a=t("./common/temp/node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(r,"__esModule",{value:true});r.default=void 0;var s=a(t("./common/temp/node_modules/lodash/pick.js"));var n=a(t("./common/temp/node_modules/@sqs/network/lib/index.js"));var i=a(t("./src/main/webapp/universal/src/shared/utils/ApiUtils.js"));var o="/api/billing/customer";var u=["cardToken","address","city","state","zip","country","taxStatus","createSetupIntent"];var l={loadCustomer:function e(){return n.default.get(o)},save:function e(r){var t=(0,s.default)(r,u);return n.default.put(o,t).catch(i.default.cleanFormFieldError)},create:function e(r){var t=(0,s.default)(r,u);return n.default.post(o,t).catch(i.default.cleanFormFieldError)}};var c=l;r.default=c;e.exports=r.default},"./src/main/webapp/universal/src/shared/utils/analytics/eventNames.js":function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.CHECKOUT_ENGAGEMENT_EVENT_NAME=void 0;var a="engagement_checkout_form";r.CHECKOUT_ENGAGEMENT_EVENT_NAME=a},"./src/main/webapp/universal/src/shared/utils/billing/Stripe.js":function(e,r,t){"use strict";var n=t("./common/temp/node_modules/loadjs/dist/loadjs.umd.js");var i=t("./src/main/webapp/universal/src/shared/stores/billing/StripeAPIKeyStore.js");var o=new Error("Failed to load Stripe.js");var u=null;e.exports={get:function e(){if(!u){u=new Promise(function(a,s){n("https://js.stripe.com/v3/",{success:function e(){if(!window.Stripe){s(o);return}var r=i.getState(),t=r.key;u=window.Stripe(t);a(u)},error:function e(){s(o)}})});return u}return Promise.resolve(u)},LOAD_ERROR:o}},"./src/main/webapp/universal/src/shared/utils/billing/TaxPreviewApi.js":function(e,r,t){"use strict";var f=t("./common/temp/node_modules/@sqs/network/lib/index.js").default;var a=t("./common/temp/node_modules/@sqs/i18n-ui/lib/money/index.js");var s=t("./src/main/webapp/universal/src/shared/utils/SerializationUtils.js"),n=s.deserializer;var u=n(a.fromJson,"data.taxLiability");var i={getExemptionStatus:function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t="/api/billing/tax-status";var a=r.money,s=r.productType;var n;var i;if(a){n=a.currencyCode;i=a.toFloat()}var o=Object.assign({},{value:i,currency:n,productType:s});return f.get(t,{params:o}).then(u)},getTaxLiability:function e(r){var t=r.australianBusinessNumber,a=r.canadianGstNumber,s=r.canadianPstNumber,n=r.customerCertified,i=r.vatNumber,o=r.userProvidedCountryCode,u=r.creditCardCountryCode,l=r.businessName,c=r.postalCode,d=r.productType;var m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var p="/api/billing/tax-status/preview";var v=Object.assign({},m,{australianBusinessNumber:t,canadianGstNumber:a,canadianPstNumber:s,customerCertified:n,businessName:l,vatNumber:i,userProvidedCountryCode:o,creditCardCountryCode:u,postalCode:c,productType:d});return f.get(p,{params:v})}};e.exports=i}}]);
//# sourceMappingURL=https://sourcemaps.squarespace.net/universal/scripts-compressed/0-9c728315cb3f86cac585d-min.en-US.js.map