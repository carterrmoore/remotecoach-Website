(window["wpJsonpExtractCss"]=window["wpJsonpExtractCss"]||[]).push([[21],{"./src/main/webapp/universal/src/apps/App/shared/components/ImageField/ImageField.jsx":function(e,t,a){"use strict";var n=a("./common/temp/node_modules/@babel/runtime/helpers/interopRequireWildcard.js");var r=a("./common/temp/node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;var b=r(a("./common/temp/node_modules/@babel/runtime/helpers/extends.js"));var C=r(a("./common/temp/node_modules/@babel/runtime/helpers/objectWithoutProperties.js"));var s=r(a("./common/temp/node_modules/@babel/runtime/helpers/classCallCheck.js"));var o=r(a("./common/temp/node_modules/@babel/runtime/helpers/createClass.js"));var l=r(a("./common/temp/node_modules/@babel/runtime/helpers/assertThisInitialized.js"));var i=r(a("./common/temp/node_modules/@babel/runtime/helpers/inherits.js"));var d=r(a("./common/temp/node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"));var u=r(a("./common/temp/node_modules/@babel/runtime/helpers/getPrototypeOf.js"));var S=r(a("./common/temp/node_modules/@babel/runtime/helpers/defineProperty.js"));a("./src/main/webapp/universal/src/shared/i18n/configurations/universal-ui.js");var E=r(a("./common/temp/node_modules/react/index.js"));var c=r(a("./common/temp/node_modules/prop-types/index.js"));var A=a("./src/main/webapp/universal/src/shared/i18n/index.ts");var j=r(a("./common/temp/node_modules/classnames/index.js"));var P=r(a("./common/temp/node_modules/lodash/omit.js"));var p=r(a("./common/temp/node_modules/lodash/compact.js"));var m=a("./src/main/webapp/universal/src/shared/i18n/react.ts");var f=r(a("./src/main/webapp/universal/src/apps/App/shared/actions/ContentItemActions.js"));var v=r(a("./src/main/webapp/universal/src/shared/actions/UploadActions.js"));var g=r(a("./src/main/webapp/universal/src/apps/App/shared/actions/PurchasedImageActions.js"));var h=n(a("./src/main/webapp/universal/src/apps/App/shared/utils/getAssetReferenceUrl.ts"));var w=n(a("./src/main/webapp/universal/src/apps/App/shared/utils/MediaUploadService.js"));var y=r(a("./src/main/webapp/universal/src/shared/components/fields/File.jsx"));var U=r(a("./src/main/webapp/universal/src/shared/components/UploadingState/index.js"));var k=r(a("./src/main/webapp/universal/src/shared/components/ImageJobProcessingState.jsx"));var F=r(a("./src/main/webapp/universal/src/apps/App/shared/components/ContentItemCreatingState/index.js"));var T=a("./src/main/webapp/frontend/packages/universal-ui/cjs/index.js");var L=r(a("./src/main/webapp/universal/src/apps/App/shared/components/AssetPicker/index.js"));var x=r(a("./src/main/webapp/universal/src/apps/App/shared/components/LicenseImage/index.js"));var O=r(a("./src/main/webapp/universal/src/apps/App/shared/components/ImageField/ImageField.less"));var R=a("./src/main/webapp/universal/src/shared/utils/UploadAPI.js");var _=a("./src/main/webapp/universal/src/shared/utils/uploadToken.js");var M=r(a("./src/main/webapp/universal/src/shared/utils/buildUploadPostData.js"));var I=r(a("./src/main/webapp/universal/src/apps/App/shared/components/AssetPicker/constants/LicensedAssetDestination.js"));var N=r(a("./src/main/webapp/frontend/packages/enums/RecordType.js"));var D=r(a("./src/main/webapp/frontend/packages/enums/JobStatuses.js"));var J=a("./src/main/webapp/universal/src/shared/constants/UploadModes.js");var H=a("./src/main/webapp/universal/src/shared/constants/UploadMaxSize.js");var G=a("./src/main/webapp/universal/src/shared/constants/UploadMimeTypes.js");var q=r(a("./src/main/webapp/universal/src/apps/App/shared/components/ImageEditor/index.js"));var z=r(a("./src/main/webapp/universal/src/apps/App/shared/utils/createContentItemFromAsset.js"));var B=r(a("./src/main/webapp/universal/src/shared/actions/JobActions.js"));var W=a("./src/main/webapp/universal/src/apps/App/shared/components/AssetPicker/utils/useAssetPickerOpenState.js");function Y(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}));a.push.apply(a,n)}return a}function Q(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?Y(Object(a),true).forEach(function(e){(0,S.default)(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):Y(Object(a)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}function X(r){var s=Z();return function e(){var t=(0,u.default)(r),a;if(s){var n=(0,u.default)(this).constructor;a=Reflect.construct(t,arguments,n)}else a=t.apply(this,arguments);return(0,d.default)(this,a)}}function Z(){if("undefined"===typeof Reflect||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if("function"===typeof Proxy)return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}var V=[];var K=function e(){};var $={Initial:"initial",Upload:"upload",Process:"process",Create:"create",Load:"load"};var ee={purchasingLicensedImage:false,imageLoaded:false,imageError:false,imageHeight:null,isImageEditorOpen:false,itemState:$.Initial,item:null,prevItem:null};var te=function(e){(0,i.default)(I,e);var n=X(I);function I(){var c;(0,s.default)(this,I);for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];c=n.call.apply(n,[this].concat(t));(0,S.default)((0,l.default)(c),"state",ee);(0,S.default)((0,l.default)(c),"resetAllStates",function(){c.setState(ee)});(0,S.default)((0,l.default)(c),"resetImageLoadStates",function(){c.setState({imageLoaded:false,imageError:false,imageHeight:null})});(0,S.default)((0,l.default)(c),"resetPrevItem",function(){var e=c.state.prevItem;c.setState({itemState:$.Load,prevItem:null,item:e});c.resetImageLoadStates()});(0,S.default)((0,l.default)(c),"handleFocalPointChange",function(e){var t=e.x,a=e.y;var n=c.state.item;var r=c.props,s=r.onFocalPointChange,o=r.onUpdate;if(s)s({x:t,y:a});else{var l=Q({},n.mediaFocalPoint,{x:t,y:a});f.default.updateField(n.id,"mediaFocalPoint",l);o(n.id)}});(0,S.default)((0,l.default)(c),"handleFileFieldSelect",function(e){var t=(0,_.getUploadToken)();var a=c.getUploadData(e);c.upload(t,a);c.setState({itemState:$.Upload,item:{uploadToken:t}})});(0,S.default)((0,l.default)(c),"upload",function(e,t){var a=c.props.uploadSource;if((0,w.isMediaUploadServiceEnabled)()&&a){var n=(0,h.default)(h.AssetReferenceType.TRANSIENT_IMAGE);w.default.uploadFile(e,t,n,a)}else v.default.uploadFile(e,R.URLS.IMAGE,t,a)});(0,S.default)((0,l.default)(c),"handleUploadComplete",function(e){var t=e.data;var a=t.contentItem;a?c.handleContentItemCreate(a):c.setState({itemState:$.Process,item:{jobId:t.jobId}})});(0,S.default)((0,l.default)(c),"handleUploadIncomplete",function(){var e=c.state.prevItem;e?c.resetPrevItem():c.resetAllStates()});(0,S.default)((0,l.default)(c),"handleJobComplete",function(e){if(e.contentItemId){var t=c.props,a=t.onJobComplete,n=t.onUpdate;(a||n)(e.contentItemId)}else c.setState({itemState:$.Create,item:{assetId:e.assetId}})});(0,S.default)((0,l.default)(c),"handleJobIncomplete",function(e){var t=c.props.contentItemId;if(t){e===D.default.CANCELLED&&f.default.delete(t);c.requestRemove()}else c.resetAllStates()});(0,S.default)((0,l.default)(c),"handleJobProcessingCancel",function(){var e=c.state.item.jobId;c.props.contentItemId?B.default.cancel(e):B.default.cancelMediaUploadServiceJob(e)});(0,S.default)((0,l.default)(c),"handleContentItemCreate",function(e){var t=c.state.prevItem;var a=c.props,n=a.onChange,r=a.onUpdate;t&&t.id===e.id?r(t.id):n(e.id)});(0,S.default)((0,l.default)(c),"handleContentItemFailure",function(){var e=c.state.prevItem;e?c.resetPrevItem():c.resetAllStates()});(0,S.default)((0,l.default)(c),"handleImageLoad",function(e,t,a){c.setState({imageHeight:a,imageLoaded:true})});(0,S.default)((0,l.default)(c),"handleImageError",function(e){c.setState({imageError:true})});(0,S.default)((0,l.default)(c),"requestRemove",function(){setTimeout(function(){c.props.onChange(null)},0)});(0,S.default)((0,l.default)(c),"getUploadData",function(e,t){return(0,M.default)(e,N.default.IMAGE,J.TRANSIENT,t)});(0,S.default)((0,l.default)(c),"uploadFromFileUrl",function(e,t){var a=(0,_.getUploadToken)();v.default.uploadFromFileUrl(a,R.URLS.IMAGE,t);c.setState({itemState:$.Upload,item:{uploadToken:a}})});(0,S.default)((0,l.default)(c),"editImage",function(){c.props.onClickEdit?c.props.onClickEdit():c.setState({isImageEditorOpen:true})});(0,S.default)((0,l.default)(c),"handleCancelImageEditor",function(){c.setState({isImageEditorOpen:false})});(0,S.default)((0,l.default)(c),"handleSaveImageEditor",function(e){var t=c.state.item;var a=(0,_.getUploadToken)();var n=(0,M.default)(e,N.default.IMAGE,"transient",{replaceItemId:t.id});c.upload(a,n);c.setState({isImageEditorOpen:false,itemState:$.Upload,prevItem:t,item:{uploadToken:a}})});(0,S.default)((0,l.default)(c),"handleChooseAssetIds",function(e){var t=e.assetIds;c.props.onClosePicker();(0,z.default)(h.AssetReferenceType.TRANSIENT_IMAGE,t[0]).then(function(e){f.default.insert(e);c.handleContentItemCreate(e)})});(0,S.default)((0,l.default)(c),"handleChooseImageUrl",function(e){var t=e.data;c.props.onClosePicker();c.uploadFromFileUrl(t.url,c.getUploadData(t))});(0,S.default)((0,l.default)(c),"handleLicensedImagePurchase",function(e){c.uploadFromFileUrl(e.url,c.getUploadData(e));c.setState({purchasingLicensedImage:false})});(0,S.default)((0,l.default)(c),"openLicensedImagePicker",function(){c.props.onOpenPicker()});(0,S.default)((0,l.default)(c),"getEmptyImageButtonConfig",function(){if(c.props.allowLicensedImage)return[{key:"licensed-image-get",label:E.default.createElement("span",{className:O.default.buttonLabelContainer},E.default.createElement("span",{className:O.default.searchIcon}),E.default.createElement(m.T,{project:"apps.App"},"Search For Image")),className:O.default.searchImages,onClick:c.openLicensedImagePicker}];return V});(0,S.default)((0,l.default)(c),"getPreviewingImageButtonConfig",function(){return[{key:"licensed-image-purchase",label:(0,A.t)("License"),onClick:function e(){c.setState({purchasingLicensedImage:true})}},{key:"remove",label:(0,A.t)("Remove"),onClick:c.requestRemove}]});(0,S.default)((0,l.default)(c),"getEditableImageButtonConfig",function(){var e=c.props.isEditable;var t=(0,A.t)("Edit Image");return(0,p.default)([e&&{key:"edit",label:t,onClick:c.editImage},{key:"remove",label:(0,A.t)("Remove"),className:O.default.removeIcon,onClick:c.requestRemove}])});(0,S.default)((0,l.default)(c),"getButtonConfig",function(){var e=c.state,t=e.imageLoaded,a=e.itemState,n=e.item;var r=[$.Upload,$.Process,$.Create];if(a===$.Initial)return c.getEmptyImageButtonConfig();if(r.includes(a))return V;if(n.licensedAssetPreview)return c.getPreviewingImageButtonConfig();if(t)return c.getEditableImageButtonConfig();return[{key:"remove",label:(0,A.t)("Remove"),onClick:c.requestRemove}]});(0,S.default)((0,l.default)(c),"renderImageUploadingState",function(){return E.default.createElement(U.default,{key:"uploading",uploadToken:c.state.item.uploadToken,onUploadComplete:c.handleUploadComplete,onUploadIncomplete:c.handleUploadIncomplete})});(0,S.default)((0,l.default)(c),"renderImageJobProcessingState",function(){return E.default.createElement(k.default,{key:"processing",jobId:c.state.item.jobId,onJobComplete:c.handleJobComplete,onJobIncomplete:c.handleJobIncomplete,onRequestCancel:c.handleJobProcessingCancel})});(0,S.default)((0,l.default)(c),"renderImageContentItemCreatingState",function(){return E.default.createElement(F.default,{key:"contentItemCreating",assetId:c.state.item.assetId,onContentItemCreate:c.handleContentItemCreate,onContentItemFailure:c.handleContentItemFailure})});(0,S.default)((0,l.default)(c),"getFocalPoint",function(){var e=c.state.item;var t=c.props.focalPointOverride;var a=e.mediaFocalPoint,n=void 0===a?{}:a;return t||n});(0,S.default)((0,l.default)(c),"renderImage",function(){var e=c.state,t=e.imageLoaded,a=e.item;var n=c.props.isFocalPointEditable;var r=a.assetUrl,s=a.originalSize,o=a.systemDataVariants;var l=c.getFocalPoint();var i=o?o.replace(s+",",""):null;if(!n)return E.default.createElement(T.Image,{key:"image",onLoad:c.handleImageLoad,onError:c.handleImageError,src:r,originalSize:s,formattedWidths:i});return E.default.createElement(T.Image,{ref:function e(t){c.imgNode=t},onLoad:c.handleImageLoad,onError:c.handleImageError,src:r,originalSize:s,formattedWidths:i},E.default.createElement(T.FocalPoint,{visible:t,onChange:c.handleFocalPointChange,imageNodeGetter:function e(){return c.imgNode},x:l.x,y:l.y}))});(0,S.default)((0,l.default)(c),"renderLicensedImageComponents",function(){var e=c.props.imageDestination;var t=c.state,a=t.purchasingLicensedImage,n=t.itemState,r=t.item;if(n===$.Initial)return E.default.createElement(L.default,{onChooseAssetIds:c.handleChooseAssetIds,onChooseImageUrl:c.handleChooseImageUrl,imageDestination:e,isOpen:c.props.isPickerOpen,onRequestClose:c.props.onClosePicker});var s=r.assetUrl,o=r.licensedAssetId,l=r.licensedAssetPreview,i=r.licensedAssetOriginUrl,d=r.showGettyLicenseText;if(l)return[E.default.createElement(x.default,{key:"licensed-image-purchase-modal",assetPreview:l,previewUrl:s,isOpen:a,onRequestClose:function e(){return c.setState({purchasingLicensedImage:false})},onPurchaseSuccess:c.handleLicensedImagePurchase}),E.default.createElement("div",{key:"licensed-image-preview-desc",className:O.default.description},E.default.createElement(m.T,{project:"apps.App"},"This is an unlicensed preview image. To purchase its license, click on the license button above. Watermarks will be removed after purchase."))];if(o&&d){var u=E.default.createElement("a",{href:i,target:"_blank"},E.default.createElement(m.T,{project:"apps.App"},"here"));return E.default.createElement("div",{className:O.default.description},E.default.createElement(m.T,{textLink:u,project:"apps.App"},"This is a licensed image. Click {textLink} to review licensing options for print, social, and more."))}});(0,S.default)((0,l.default)(c),"renderFileThumbnail",function(){var e=c.state.itemState;switch(e){case $.Upload:return c.renderImageUploadingState();case $.Process:return c.renderImageJobProcessingState();case $.Create:return c.renderImageContentItemCreatingState();default:return c.renderImage()}});return c}(0,o.default)(I,[{key:"UNSAFE_componentWillReceiveProps",value:function e(t){var a=this.props.value;var n=t.value;if(n&&n!==a){var r=n.jobId?$.Process:$.Load;this.setState({itemState:r,item:n})}if(n&&a&&n.assetUrl!==a.assetUrl)return this.resetImageLoadStates();if(!n&&a)return this.resetAllStates()}},{key:"componentDidUpdate",value:function e(){var t=this.state,a=t.itemState,n=t.item;a===$.Load&&!n.assetSource&&n.licensedAssetId&&g.default.fetch.defer()}},{key:"renderImageEditor",value:function e(){var t=this.state,a=t.isImageEditorOpen,n=t.itemState,r=t.item;if(n===$.Load)return E.default.createElement(q.default,{imageSrc:r.assetUrl,isOpen:a,onCancel:this.handleCancelImageEditor,onSave:this.handleSaveImageEditor})}},{key:"render",value:function e(){var t;var a=this.state,n=a.imageHeight,r=a.imageError,s=a.item;var o=this.props,l=o.children,i=o.label,d=o.height,u=o.minHeight,c=o.maxHeight,p=o.allowLicensedImage,m=o.validMimeTypes,f=o.maxSize,v=(0,C.default)(o,["children","label","height","minHeight","maxHeight","allowLicensedImage","validMimeTypes","maxSize"]);var g=(0,P.default)(v,Object.keys(I.propTypes));var h=(0,j.default)(O.default.fileField,(t={},(0,S.default)(t,O.default.hasImage,s),(0,S.default)(t,O.default.imageError,r),t));return E.default.createElement(E.default.Fragment,null,E.default.createElement(y.default,(0,b.default)({},g,{className:O.default.container,label:i||(0,A.t)("Upload an Image"),height:d||n||c,innerContainerStyle:{minHeight:u,maxHeight:c},innerContainerClassName:h,fileThumbnailRenderer:this.renderFileThumbnail,buttonConfig:this.getButtonConfig(),validMimeTypes:m,maxSize:f||H.MAX_SIZE,uploadUrl:R.URLS.IMAGE,recordType:N.default.IMAGE,uploadMode:J.TRANSIENT,onSelect:this.handleFileFieldSelect,onChange:function e(){},value:s}),p&&this.renderLicensedImageComponents(),l),this.renderImageEditor())}}]);return I}(E.default.Component);(0,S.default)(te,"propTypes",{label:c.default.string,height:c.default.oneOfType([c.default.number,c.default.string]),minHeight:c.default.number,maxHeight:c.default.number,contentItemId:c.default.string,imageDestination:c.default.oneOf(Object.values(I.default)),value:c.default.object,onChange:c.default.func.isRequired,onUpdate:c.default.func,onJobComplete:c.default.func,maxSize:c.default.number,allowLicensedImage:c.default.bool,isFocalPointEditable:c.default.bool,isEditable:c.default.bool,validMimeTypes:c.default.array,onClickEdit:c.default.func,onFocalPointChange:c.default.func,focalPointOverride:c.default.shape({x:c.default.number,y:c.default.number})});(0,S.default)(te,"defaultProps",{allowLicensedImage:true,isEditable:true,isFocalPointEditable:true,maxHeight:330,minHeight:22,onUpdate:K,validMimeTypes:G.IMAGE_MIME_TYPES});var ae=(0,W.withAssetPickerOpenState)(te);t.default=ae;e.exports=t.default},"./src/main/webapp/universal/src/apps/App/shared/components/ImageField/ImageField.less":function(e,t,a){e.exports={fileField:"QIvEri1DM",hasImage:"_1-e5P-W8o",imageError:"_2ddgxkz-D",hidden:"_3WCuLtW87",container:"_3rAWdabt3",buttonLabelContainer:"TGN4CgUQl",searchImages:"_1XEMbYECA",searchIcon:"PTRRUCy8C",removeIcon:"_1jnfHmMD7",description:"_3Cmm5vW2Z uYtYzc1B0"}},"./src/main/webapp/universal/src/apps/App/shared/components/ImageField/index.js":function(e,t,a){"use strict";var n=a("./common/temp/node_modules/alt-utils/lib/connectToStores.js");var r=a("./src/main/webapp/universal/src/apps/App/shared/actions/ContentItemActions.js");var s=a("./src/main/webapp/universal/src/apps/App/shared/actions/PurchasedImageActions.js");var o=a("./src/main/webapp/universal/src/apps/App/shared/stores/ContentItemStore.js");var l=a("./src/main/webapp/universal/src/apps/App/shared/stores/PurchasedImageStore.js");var i=a("./src/main/webapp/universal/src/apps/App/shared/components/ImageField/ImageField.jsx");var d=a("./src/main/webapp/frontend/packages/enums/LicensedAssetSource.js");var u=n({getStores:function e(){return[o,l]},getPropsFromStores:function e(t){var a=null;if(t.contentItemId){var n=o.getState().get(t.contentItemId);if(n){a=n.toJS();if(a.licensedAssetId){var r=l.getOriginUrlFromId(a.licensedAssetId)||"";var s=l.getAssetTypeFromId(a.licensedAssetId)||"";a.assetSource=l.getAssetTypeFromId(a.licensedAssetId)||null;a.licensedAssetOriginUrl=r;a.showGettyLicenseText=s===d.GETTY}}}return{value:a}},componentDidConnect:function e(t){t.contentItemId&&!o.getState().get(t.contentItemId)&&r.read.defer(t.contentItemId);s.fetch.defer()}},i);e.exports=u}}]);
//# sourceMappingURL=https://sourcemaps.squarespace.net/universal/scripts-compressed/21-d781a91b9bbe2509a70d0-min.en-US.js.map